<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" class="jsx-74ac21e17e774b8">
    <title>智能AI小助手</title>
	<script src="{{ url_for('static', filename='js/jquery-3.6.0.min.js') }}"></script>
	<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
	<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap-theme.min.css') }}">
	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
	<!-- 使用 ClipboardJS 库实现复制功能 -->
	<script src="{{ url_for('static', filename='js/clipboard.min.js') }}"></script>
	<!-- 自定义函数 -->
	<script src="{{ url_for('static', filename='js/custom-kit.js') }}"></script>
    <!-- 自定义样式 -->
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
	<style>
	.copy-icon.right {
		background: url("{{ url_for('static', filename='images/copy.png') }}") no-repeat center center;
		background-size: 18px 18px;
		-webkit-background-size:18px 18px;
		display:inline-block;
		width: 25px;
		height: 25px;
		margin-right: 5px;
		margin-left: -5px;
		cursor: pointer;
		right: 100%;
	}
	.copy-icon.left {
		background: url("{{ url_for('static', filename='images/copy.png') }}") no-repeat center center;
		background-size: 18px 18px;
		-webkit-background-size:18px 18px;
		display:inline-block;
		width: 25px;
		height: 25px;
		margin-left: 5px;
		cursor: pointer;
		left: 100%;
	}
	.round_btn {
		align-items: center;
		justify-content: center;
		width: 28px;
		height: 28px;
		border-radius: 50%;
		background: url("{{ url_for('static', filename='images/chatgpt.png') }}") no-repeat center center;
		background-size: 32px 32px;
		-webkit-background-size: 28px;
		display: flex;
		position: relative;
		cursor: pointer;
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
	}
	</style>
</head>
<body>
<div class="chat-container">
	<div class="toolbar">
		<!--<div class="chat-header">
	<p align="center">智能AI小助手</p>
	</div>-->
	</div>
	<div class="chat-body" id="chat_content"></div>
	<div class="bottom">
		<div class="sel_icon">
			<div class="round_btn" id="round_btn"></div>
		</div>
		<div class="input-area">
			<textarea id="user-input" style="height: 0px;"></textarea>
		</div>
		<div class="btn-area">
			<div class="send-btn" id="send-btn">发送</div>
		</div>
	</div>
</div>
<script>
    // 在页面加载和chat-body高度发生变化时，调用updateOverlayHeight函数
	window.addEventListener('load', updateOverlayHeight);
	document.querySelector('.chat-body').addEventListener('scroll', updateOverlayHeight);

    const toolbar = document.querySelector('.toolbar');
    const roundBtn = document.querySelector('.round_btn');
	let isLeftShown = false;
	$(document).on('click', '.round_btn', function() {
		isLeftShown = !isLeftShown;
		toolbar.style.width = isLeftShown ? '80%' : '0';
		if (isLeftShown) {
			toolbar.classList.add('show');
			roundBtn.style.background = "url(\"{{ url_for('static', filename='images/chatgpt_black.png') }}\") no-repeat center center";
			roundBtn.style.webkitBackgroundSize = "32px";
			$('textarea').prop('disabled', true);
			$('.send-btn').css('background-color', "#969696");
			//清除输入框中内容
			$('#user-input').replaceWith($('#user-input').clone(true));
			$('#user-input').val('');
			$('#user-input').height(25);
		} else {
			toolbar.classList.remove('show');
			roundBtn.style.background = "url(\"{{ url_for('static', filename='images/chatgpt.png') }}\") no-repeat center center";
			roundBtn.style.webkitBackgroundSize = "32px";
			$('textarea').prop('disabled', false);
			$('.send-btn').css('background-color', "#4ba71e");
		}
	});

	$(document).on('click', '.chat-body', function() {
		isLeftShown = !isLeftShown;
		if (!isLeftShown) {
			toolbar.style.width = isLeftShown ? '80%' : '0';
			toolbar.classList.remove('show');
			$('textarea').prop('disabled', false);
			$('.send-btn').css('background-color', "#4ba71e");
			$('.round_btn').css('background-color', "inherit");
		}
	});

	$('#send-btn').on('click', function(event) {
		submitContent(event);
	});

	$('#send-btn').on('keydown', function(event) {
		if (event.keyCode == 13)
			submitContent(event);
	});

    //高度自适应
	$("textarea").each(function () {
		this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
	}).on("input", function () {
		this.style.height = 0;
		this.style.height = (this.scrollHeight) + "px";
		chat_content.scrollTop = chat_content.scrollHeight;
	});

	//复制操作
	$(document).on('click', '.copy-icon', function() {
		const copyIcons = document.querySelectorAll('.copy-icon');
		// 遍历 copy-icon 元素，给它们添加 click 事件监听器
		for (const copyIcon of copyIcons) {
			// 移除之前点击过的.copy-icon的title
			$(copyIcon).removeAttr('title');
			$(copyIcon).removeAttr('data-original-title');
		}
		// 获取要复制的文本
		const div = this.parentElement;
		const text = formatClipboard(div.innerHTML);
		if (text) {
			// 将文本内容复制到系统剪贴板中
			if (navigator.clipboard && navigator.clipboard.writeText) {
				navigator.clipboard.writeText(text)
				.then(() => {
					$(this).attr('title', '已复制').tooltip('fixTitle').tooltip('show');
					})
				.catch(err => {
					$(this).attr('title', '复制失败').tooltip('fixTitle').tooltip('show');
				});
			} else {
				console.error('浏览器不支持navigator操作');
				// 创建textarea
				const textArea = document.createElement('textarea');
				textArea.value = text;
				// 使textarea不在viewport，同时设置不可见
				document.body.appendChild(textArea);
				textArea.focus();
				textArea.select();
				$(this).attr('title', '已复制').tooltip('fixTitle').tooltip('show');
				return new Promise((res, rej) => {
					// 执行复制命令并移除文本框
					document.execCommand('copy', false, text) ? res() : rej()
					textArea.remove()
				})
			}
		} else {
			console.error('要复制的文本为空或未定义');
		}
	});
</script>
</body>
</html>